<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>智能防红链接生成器</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="color-scheme" content="light dark">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/iosxlb/static@main/favicon/link.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36D399',
            warning: '#FBBD23',
            danger: '#F87272',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .card-shadow {
        box-shadow: 0 10px 30px -5px rgba(22, 93, 255, 0.08), 0 4px 6px -4px rgba(22, 93, 255, 0.1);
      }
      .card-shadow-hover {
        box-shadow: 0 20px 40px -5px rgba(22, 93, 255, 0.15), 0 8px 10px -6px rgba(22, 93, 255, 0.1);
      }
      .btn-gradient {
        background: linear-gradient(90deg, #165DFF 0%, #4080FF 100%);
      }
      .btn-gradient-secondary {
        background: linear-gradient(90deg, #36D399 0%, #6EE7B7 100%);
      }
      .glow {
        box-shadow: 0 0 0 2px #4080FF, 0 0 10px 2px rgba(22, 93, 255, 0.3);
      }
      .animate-fadeIn {
        animation: fadeIn .5s ease-out forwards;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
      }
    }
    .color-radio:checked + label {
      border-width: 3px;
      border-color: #165DFF;
      box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.3);
    }
    .delay-radio:checked + label,
    .expire-radio:checked + label {
      border-color: #165DFF;
      background-color: rgba(22, 93, 255, 0.05);
    }
    body {
      -webkit-user-scale-factor: 1 !important;
      touch-action: manipulation;
      overflow-x: hidden;
    }
    .fixed-position {
      position: fixed !important;
      width: 100%;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen flex items-center justify-center px-3 py-8 font-inter text-dark">
  <div class="container max-w-md w-full bg-white/95 rounded-3xl card-shadow transition-all duration-300 hover:card-shadow-hover overflow-hidden backdrop-blur-2xl">
    <div class="h-1.5 bg-gradient-to-r from-primary to-blue-400"></div>
    <div class="flex justify-center mt-6">
      <div class="w-16 h-16 flex items-center justify-center rounded-full bg-primary shadow-lg text-white text-2xl glow">
        <<i class="fa fa-link"></</i>
      </div>
    </div>
    <div class="text-center pt-3 pb-2 px-5">
      <h1 class="text-2xl font-extrabold text-primary drop-shadow-sm tracking-wide mb-2">智能防红链接生成器</h1>
      <p class="text-gray-500 text-sm mb-3">安全转换 · 稳定防红 · 免费无广告</p>
    </div>
    <div class="p-5 pt-2 mx-4">
      <label for="targetUrl" class="block text-gray-700 font-medium mb-2 text-sm">
        <<i class="fa fa-globe mr-1"></</i> 目标网址
      </label>
      <div class="relative">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
          <<i class="fa fa-link"></</i>
        </span>
        <input 
          type="text" 
          id="targetUrl" 
          placeholder="https://需要防红的网址.com" 
          class="w-full pl-10 pr-4 py-3.5 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 text-sm bg-gray-50"
          autocomplete="off"
        >
      </div>
      
      <!-- 二维码颜色选择 -->
      <div class="mt-5">
        <span class="text-xs text-gray-700 font-medium mb-1.5 block">二维码颜色：</span>
        <div class="flex flex-wrap gap-2.5">
          <input type="radio" name="qrcolor" id="qrcolor1" class="hidden color-radio" value="#165DFF" checked>
          <label for="qrcolor1" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer" style="background:#165DFF"></label>
          <input type="radio" name="qrcolor" id="qrcolor2" class="hidden color-radio" value="#36D399">
          <label for="qrcolor2" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer" style="background:#36D399"></label>
          <input type="radio" name="qrcolor" id="qrcolor3" class="hidden color-radio" value="#F87272">
          <label for="qrcolor3" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer" style="background:#F87272"></label>
          <input type="radio" name="qrcolor" id="qrcolor4" class="hidden color-radio" value="#FBBD23">
          <label for="qrcolor4" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer" style="background:#FBBD23"></label>
          <input type="radio" name="qrcolor" id="qrcolor5" class="hidden color-radio" value="#1E293B">
          <label for="qrcolor5" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer" style="background:#1E293B"></label>
        </div>
      </div>
      
      <!-- 跳转延迟时间选择 -->
      <div class="mt-5">
        <span class="text-xs text-gray-700 font-medium mb-1.5 block">跳转延迟时间：</span>
        <div class="flex flex-wrap gap-2.5">
          <input type="radio" name="delayTime" id="delay1" class="hidden delay-radio" value="500" checked>
          <label for="delay1" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">0.5秒</label>
          <input type="radio" name="delayTime" id="delay2" class="hidden delay-radio" value="800">
          <label for="delay2" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">0.8秒</label>
          <input type="radio" name="delayTime" id="delay3" class="hidden delay-radio" value="1000">
          <label for="delay3" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">1秒</label>
          <input type="radio" name="delayTime" id="delay4" class="hidden delay-radio" value="1500">
          <label for="delay4" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">1.5秒</label>
        </div>
      </div>
      
      <!-- 链接有效期选择 -->
      <div class="mt-5">
        <span class="text-xs text-gray-700 font-medium mb-1.5 block">链接有效期：</span>
        <div class="flex flex-wrap gap-2.5">
          <input type="radio" name="expireTime" id="expire1" class="hidden expire-radio" value="0" checked>
          <label for="expire1" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">永久有效</label>
          <input type="radio" name="expireTime" id="expire2" class="hidden expire-radio" value="3600">
          <label for="expire2" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">1小时</label>
          <input type="radio" name="expireTime" id="expire3" class="hidden expire-radio" value="86400">
          <label for="expire3" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">1天</label>
          <input type="radio" name="expireTime" id="expire4" class="hidden expire-radio" value="604800">
          <label for="expire4" class="px-3 py-1.5 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-sm">7天</label>
        </div>
      </div>
      
      <button 
        class="btn-gradient w-full py-3.5 rounded-lg text-white font-semibold mt-5 shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 text-base"
        onclick="generate()"
        id="generateBtn"
      >
        <<i class="fa fa-magic mr-2"></</i> 生成防红链接
      </button>
    </div>
    <div id="result" class="hidden p-5 mx-4 mt-2 animate-fadeIn">
      <div class="bg-blue-50 border-l-4 border-primary p-4 rounded-lg mb-4">
        <div class="flex items-center justify-between mb-2.5">
          <span class="text-gray-700 font-semibold text-xs">防红链接</span>
          <span class="text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full">已防红</span>
        </div>
        <div id="output" class="text-sm text-blue-800 break-all select-all relative font-mono py-2.5 px-3 rounded bg-blue-100">
          <!-- 链接将在这里生成 -->
        </div>
        <button 
          class="btn-gradient-secondary w-full py-3 rounded-lg text-white font-medium mt-3.5 shadow hover:shadow-lg transition-all duration-300 text-base"
          onclick="copyResult()"
        >
          <<i class="fa fa-clipboard mr-2"></</i> 一键复制链接
        </button>
      </div>
      <div class="text-center pt-3">
        <h3 class="text-gray-600 font-medium text-xs mb-2.5 tracking-wide">
          <<i class="fa fa-qrcode mr-1"></</i> 手机扫码访问
        </h3>
        <div id="qrcode" class="mx-auto p-3 bg-white rounded-lg shadow w-max"></div>
        <p class="text-xs text-gray-400 mt-2.5">长按二维码可保存图片</p>
      </div>
    </div>
  </div>
  <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg z-50 hidden text-white font-medium text-sm"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const inputFields = document.querySelectorAll('input, textarea');
      let initialScrollY = 0;
      
      inputFields.forEach(input => {
        input.addEventListener('focus', function() {
          initialScrollY = window.scrollY;
          document.body.classList.add('fixed-position');
          document.body.style.top = `-${initialScrollY}px`;
        });
        
        input.addEventListener('blur', function() {
          document.body.classList.remove('fixed-position');
          window.scrollTo(0, initialScrollY);
        });
      });
      
      document.addEventListener('touchstart', function(event) {
        if (event.touches.length > 1) {
          event.preventDefault();
        }
      }, { passive: false });
      
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, { passive: false });
    });

    function base64Encode(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    function generate() {
      var url = document.getElementById('targetUrl').value.trim();
      var btn = document.getElementById('generateBtn');
      var qrcolor = document.querySelector('input[name="qrcolor"]:checked').value || "#165DFF";
      var delayTime = document.querySelector('input[name="delayTime"]:checked').value || "800";
      var expireTime = document.querySelector('input[name="expireTime"]:checked').value || "0";
      
      if (!url) {
        showToast('请输入目标网址！', 'error');
        return;
      }
      
      if (!/^https:\/\//i.test(url)) {
        showToast('仅支持以 https:// 开头的链接！', 'error');
        return;
      }
    
      btn.disabled = true;
      btn.innerHTML = '<<i class="fa fa-spinner fa-spin mr-2"></</i> 生成中...';
    
      setTimeout(() => {
        // 拼接原始链接、延迟时间、有效期，双重编码增强隐蔽性
        var rawData = url + '|' + delayTime + '#' + expireTime;
        var base64Data = btoa(unescape(encodeURIComponent(rawData)));
        var finalEncodedUrl = encodeURIComponent(base64Data);
        
        // 生成最终防红链接
        var currentOrigin = window.location.origin;
        var currentPath = window.location.pathname.split('/').slice(0, -1).join('/');
        var resultUrl = `${currentOrigin}${currentPath}/ink.htm/${finalEncodedUrl}`;
        
        document.getElementById('output').textContent = resultUrl;
        document.getElementById('result').classList.remove('hidden');
        
        // 生成二维码
        var qrcodeDiv = document.getElementById('qrcode');
        qrcodeDiv.innerHTML = "";
        new QRCode(qrcodeDiv, {
          text: resultUrl,
          width: Math.min(190, window.innerWidth * 0.7),
          height: Math.min(190, window.innerWidth * 0.7),
          colorDark: qrcolor,
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
    
        btn.disabled = false;
        btn.innerHTML = '<<i class="fa fa-magic mr-2"></</i> 生成防红链接';
        showToast('防红链接生成成功！', 'success');
      }, 600);
    }

    function copyResult() {
      var text = document.getElementById('output').textContent;
      
      if (!text) {
        showToast('没有可复制的链接！', 'error');
        return;
      }
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showToast('链接已复制！', 'success');
        }).catch(err => {
          showToast('复制失败：' + err, 'error');
        });
      } else {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showToast('链接已复制！', 'success');
        } catch (err) {
          showToast('复制失败，请手动复制', 'error');
        }
        document.body.removeChild(textarea);
      }
    }

    function showToast(message, type = 'info') {
      var toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'fixed bottom-8 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg z-50 text-white font-medium text-sm animate-fadeIn';
      toast.style.background = type === 'success' ? '#36D399' : (type === 'error' ? '#F87272' : '#165DFF');
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 2500);
    }

    document.oncontextmenu = function() { return false; };
    document.onselectstart = function() { return false; };
    
    document.onkeydown = function() {
      if (window.event && window.event.keyCode == 123) {
        event.keyCode = 0;
        event.returnValue = false;
        return false;
      }
      if (event.shiftKey && event.ctrlKey && event.keyCode === 73) {
        event.preventDefault();
        return false;
      }
    };
  </script>
</body>
</html>
